@prefix rr:      <http://www.w3.org/ns/r2rml#> .
@prefix rml:     <http://semweb.mmlab.be/ns/rml#> .
@prefix ql:      <http://semweb.mmlab.be/ns/ql#> .
@prefix xsd:     <http://www.w3.org/2001/XMLSchema#> .
@prefix rdfs:    <http://www.w3.org/2000/01/rdf-schema#> .
@prefix owl:     <http://www.w3.org/2002/07/owl#> .
@prefix schema:  <https://schema.org/> .
@prefix ex: <https://www.roadsafetydata.com/ontology#> .

@base <https://www.roadsafetydata.com/> .

<#SrcAcc>
  a rml:LogicalSource ;
  rml:source "data/2025-Accidentalidad-with-links.csv" ;
  rml:referenceFormulation ql:CSV .

<#TM_District>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcAcc> ;
  rr:subjectMap [
    rr:template "https://www.roadsafetydata.com/resource/District/{cod_distrito}" ;
    rr:class schema:AdministrativeArea
  ] ;
  rr:predicateObjectMap [
    rr:predicate rdfs:label ;
    rr:objectMap [ rml:reference "distrito" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate owl:sameAs ;
    rr:objectMap [ rml:reference "same_as_wikidata_distrito" ; rr:termType rr:IRI ]
  ] .

<#TM_VehicleType>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcAcc> ;
  rr:subjectMap [
    rr:template "https://www.roadsafetydata.com/resource/vehicle-type/{tipo_vehiculo}" ;
    rr:class schema:Vehicle
  ] ;
  rr:predicateObjectMap [
    rr:predicate rdfs:label ;
    rr:objectMap [ rml:reference "tipo_vehiculo" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate owl:sameAs ;
    rr:objectMap [ rml:reference "same_as_wikidata_tipo_vehiculo" ; rr:termType rr:IRI ]
  ] .

<#TM_Gender>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcAcc> ;
  rr:subjectMap [
    rr:template "https://www.roadsafetydata.com/resource/sex/{sexo}" ;
    rr:class schema:Enumeration
  ] ;
  rr:predicateObjectMap [
    rr:predicate rdfs:label ;
    rr:objectMap [ rml:reference "sexo" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate owl:sameAs ;
    rr:objectMap [ rml:reference "same_as_wikidata_sexo" ; rr:termType rr:IRI ]
  ] .


<#AccidentParticipantTM>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcAcc> ;
  rr:subjectMap [
    rr:template "https://www.roadsafetydata.com/resource/person/{num_expediente}-{tipo_persona}-{sexo}-{rango_edad}" ;
    rr:class schema:Person
  ] ;
    rr:predicateObjectMap [
    rr:predicate rdfs:label ;
    rr:objectMap [ rr:template "{tipo_persona} {sexo} {rango_edad} {tipo_vehiculo}" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:gender ;
    rr:objectMap [ rr:parentTriplesMap <#TM_Gender> ]
  ] ;
    rr:predicateObjectMap [
    rr:predicate ex:ageRange ;
    rr:objectMap [ rml:reference "rango_edad" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:roleName ;
    rr:objectMap [ rml:reference "tipo_persona" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:ageRange ;
    rr:objectMap [ rml:reference "rango_edad" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:injuryCode ;
    rr:objectMap [ rml:reference "cod_lesividad" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:injuryLabel ;
    rr:objectMap [ rml:reference "lesividad" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:positiveAlcohol ;
    rr:objectMap [ rml:reference "positiva_alcohol" ; rr:datatype xsd:string ]
] ;
  rr:predicateObjectMap [
    rr:predicate ex:positiveDrug ;
    rr:objectMap [ rml:reference "positiva_droga" ; rr:datatype xsd:string ]
  ] .


<#AccidentTM>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcAcc> ;
  rr:subjectMap [
    rr:template "https://www.roadsafetydata.com/resource/Accident/{num_expediente}" ;
    rr:class schema:Event
  ] ;

  # Datos básicos
  rr:predicateObjectMap [
    rr:predicate rdfs:label ;
    rr:objectMap [ rr:template "{num_expediente}" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:startDate ;
    rr:objectMap [ rml:reference "fecha" ; rr:datatype xsd:date ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:startTime ;
    rr:objectMap [ rml:reference "hora" ; rr:datatype xsd:time ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:weather ;
    rr:objectMap [ rml:reference "estado_meteorológico" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:accidentType ;
    rr:objectMap [ rml:reference "tipo_accidente" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:location ;
    rr:objectMap [ rml:reference "localizacion" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:streetNumber ;
    rr:objectMap [ rml:reference "numero" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:utmX ;
    rr:objectMap [ rml:reference "coordenada_x_utm" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:utmY ;
    rr:objectMap [ rml:reference "coordenada_y_utm" ; rr:datatype xsd:string ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate schema:areaServed ;
    rr:objectMap [ rr:parentTriplesMap <#TM_District> ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:eventType ;
    rr:objectMap [ rr:parentTriplesMap <#TM_VehicleType> ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:involvesPerson ;
    rr:objectMap [ rr:parentTriplesMap <#AccidentParticipantTM> ]
  ] .
############################################################
# 2) POBLACIÓN  (data/poblacion-1-enero-update.csv)
############################################################
<#SrcPop>
  a rml:LogicalSource ;
  rml:source "data/poblacion-1-enero-with-links.csv" ;
  rml:referenceFormulation ql:CSV .

<#TM_District_FromPop>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcPop> ;
  rr:subjectMap [
    rr:template "https://www.roadsafetydata.com/resource/District/{cod_distrito}" ;
    rr:class schema:AdministrativeArea
  ] ;
  rr:predicateObjectMap [
    rr:predicate rdfs:label ;
    rr:objectMap [ rml:reference "distrito" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:identifier ;
    rr:objectMap [ rml:reference "cod_distrito" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate owl:sameAs ;
    rr:objectMap [ rml:reference "same_as_wikidata_distrito" ; rr:termType rr:IRI ]
  ] .

<#TM_Neighbourhood>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcPop> ;
  rr:subjectMap [
    rr:template "https://www.roadsafetydata.com/resource/Neighbourhood/{cod_barrio}" ;
    rr:class schema:AdministrativeArea
  ] ;
  rr:predicateObjectMap [
    rr:predicate rdfs:label ;
    rr:objectMap [ rml:reference "barrio" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:containedInPlace ;
    rr:objectMap [ rr:template "https://www.roadsafetydata.com/resource/District/{cod_distrito}" ]
  ] .

<#TM_PopulationObs>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcPop> ;
  rr:subjectMap [
    rr:template "https://www.roadsafetydata.com/resource/Population/{fecha}-{cod_municipio}-{cod_distrito}-{cod_barrio}" ;
    rr:class ex:PopulationObservation
  ] ;
  rr:predicateObjectMap [
    rr:predicate rdfs:label ;
    rr:objectMap [ rr:template "{fecha} D{cod_distrito}-B{cod_barrio}" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:startDate ;
    rr:objectMap [ rml:reference "fecha" ; rr:datatype xsd:date ]
  ] ;
  
  rr:predicateObjectMap [
    rr:predicate ex:peopleTotal ;
    rr:objectMap [ rml:reference "num_personas" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:peopleMale ;
    rr:objectMap [ rml:reference "num_personas_hombres" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:peopleFemale ;
    rr:objectMap [ rml:reference "num_personas_mujeres" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:forDistrict ;
    rr:objectMap [ rr:template "https://www.roadsafetydata.com/resource/District/{cod_distrito}" ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:forNeighbourhood ;
    rr:objectMap [ rr:template "https://www.roadsafetydata.com/resource/Neighbourhood/{cod_barrio}" ]
  ] .

<#SrcRad>
  a rml:LogicalSource ;
  rml:source "data/RADARES-FIJOS-vDTT-with-links.csv" ;
  rml:referenceFormulation ql:CSV .


<#TM_Road>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcRad> ;
  rr:subjectMap [
    rr:template "https://www.roadsafetydata.com/resource/Road/{carretera o vial}" ;
    rr:class schema:Road
  ] ;
  rr:predicateObjectMap [
    rr:predicate rdfs:label ;
    rr:objectMap [ rml:reference "carretera o vial" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate owl:sameAs ;
    rr:objectMap [ rml:reference "same_as_wikidata_carretera" ; rr:termType rr:IRI ]
  ] .

<#TM_Responsible>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcRad> ;
  rr:subjectMap [
    rr:template "https://www.roadsafetydata.com/resource/Authority/{Responsable}" ;
    rr:class schema:Organization
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:name ;
    rr:objectMap [ rml:reference "Responsable" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate owl:sameAs ;
    rr:objectMap [ rml:reference "same_as_wikidata_responsable" ; rr:termType rr:IRI ]
  ] .


<#TM_Radar>
  a rr:TriplesMap ;
  rml:logicalSource <#SrcRad> ;
  rr:subjectMap [
    # OJO: el placeholder debe coincidir EXACTO con la cabecera "nº radar"
    rr:template "https://www.roadsafetydata.com/resource/Radar/{nº radar}" ;
    rr:class ex:SpeedCamera
  ] ;
  rr:predicateObjectMap [
    rr:predicate rdfs:label ;
    rr:objectMap [ rml:reference "ubicacion" ; rr:datatype xsd:string ]
  ] ;

  ################################
  rr:predicateObjectMap [
    rr:predicate schema:location ;
    rr:objectMap [ rml:reference "ubicacion" ; rr:datatype xsd:string ]
  ] ;
  #########################################
  
  rr:predicateObjectMap [
    rr:predicate ex:calle30Code ;
    rr:objectMap [ rml:reference "ubicacion calle 30" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:pk ;
    rr:objectMap [ rml:reference "pk" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:direction ;
    rr:objectMap [ rml:reference "sentido" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:cameraType ;
    rr:objectMap [ rml:reference "Tipo" ; rr:datatype xsd:string ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:lane ;
    rr:objectMap [ rml:reference "Carril" ; rr:datatype xsd:string ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ex:startLongitude ;
    rr:objectMap [ rml:reference "Longitud inicio tramo" ; rr:datatype xsd:double ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:startLatitude ;
    rr:objectMap [ rml:reference "Latitud inicio tramo" ; rr:datatype xsd:double ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate ex:utmX ;
    rr:objectMap [ rml:reference "X (WGS84)" ; rr:datatype xsd:double ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:utmY ;
    rr:objectMap [ rml:reference "Y (WGS84)" ; rr:datatype xsd:double ]
  ] ;

  rr:predicateObjectMap [
    rr:predicate schema:longitude ;
    rr:objectMap [ rml:reference "Longitud" ; rr:datatype xsd:double ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate schema:latitude ;
    rr:objectMap [ rml:reference "Latitud" ; rr:datatype xsd:double ]
  ] ;

  # Límite de velocidad y autoridad
  rr:predicateObjectMap [
    rr:predicate ex:speedLimit ;
    rr:objectMap [ rml:reference "Velocidad limite" ; rr:datatype xsd:string ]
  ] ;

  
  rr:predicateObjectMap [
    rr:predicate ex:road ;
    rr:objectMap [ rr:parentTriplesMap <#TM_Road> ]
  ] ;
  rr:predicateObjectMap [
    rr:predicate ex:responsible ;
    rr:objectMap [ rr:parentTriplesMap <#TM_Responsible> ]
  ] .
